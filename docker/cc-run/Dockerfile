FROM python:3.11-slim-bookworm

RUN apt-get update && apt-get upgrade -y

# set work directory
WORKDIR /voter-pipeline

# copy project
COPY . .

# env args
ARG SP_API_KEY
ARG SP_STEP_ID
ARG SP_VOTE_DATE_DETAIL_ID
ARG SP_VOTE_TYPE_DETAIL_ID
ARG SP_URL
ARG CIVIS_API_KEY
ARG LOCAL_NUMBER
ARG STATE_ABBREVIATION
ARG COUNTY_NAME
ARG DATABASE_NAME
ARG SCHEMA_NAME

# set environment variables
ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1
ENV SP_API_KEY=${SP_API_KEY}
ENV SP_STEP_ID=${SP_STEP_ID}
ENV SP_VOTE_DATE_DETAIL_ID=${SP_VOTE_DATE_DETAIL_ID}
ENV SP_VOTE_TYPE_DETAIL_ID=${SP_VOTE_TYPE_DETAIL_ID}
ENV SP_URL=${SP_URL}
ENV CIVIS_API_KEY=${CIVIS_API_KEY}
ENV LOCAL_NUMBER=${LOCAL_NUMBER}
ENV STATE_ABBREVIATION=${STATE_ABBREVIATION}
ENV COUNTY_NAME=${COUNTY_NAME}
ENV DATABASE_NAME=${DATABASE_NAME}
ENV SCHEMA_NAME=${SCHEMA_NAME}

# install dependencies
RUN bash ./bin/install
CMD ["sh -c '. /voter-pipeline/venv3.11/bin/activate'"]
